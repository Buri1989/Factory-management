<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <title>Add New Employee</title>
  </head>

  <body onload="getAllDepartments()">
    <div class="container" style="margin-top: 50px">
      <h1>Add New Employee</h1>
      <br />
      <form>
        <div class="form-label">
          <label for="firstName">First name</label>
          <input
            type="text"
            class="form-control"
            id="firstName"
            aria-describedby="emailHelp"
            placeholder="First name"
            required
          />
        </div>
        <div class="form-label">
          <label for="lastName">Last name</label>
          <input
            type="text"
            class="form-control"
            id="lastName"
            placeholder="Last name"
            required
          />
        </div>
        <div class="form-group">
          <label for="departments">Departments</label>
          <select id="departmentsDropDown"></select>
        </div>
        <br />
        <button type="input" class="btn btn-primary" onclick="add()">
          Add
        </button>
        <button
          type="input"
          class="btn btn-primary"
          onclick="window.location='employeesPage.html'"
        >
          Cancel
        </button>
      </form>
    </div>
    <script>
      const urlEmployees = "http://localhost:8000/employees";
      const urlDepartments = "http://localhost:8000/departments";

      async function getAllDepartments() {
        const responseDepartment = await fetch(urlDepartments);
        const departments = await responseDepartment.json();
        const departmentsDropDown = document.getElementById(
          "departmentsDropDown"
        );

        departments.map((dep) => {
          const option = document.createElement("option");
          option.innerHTML = dep.name;
          option.id = dep.name + "Dep";
          departmentsDropDown.appendChild(option);
        });
      }

      async function add() {
        const responseDepartment = await fetch(urlDepartments);
        const departments = await responseDepartment.json();

        const departmentsDropDown = document.getElementById(
          "departmentsDropDown"
        );
        const departmentValue =
          departmentsDropDown.options[departmentsDropDown.selectedIndex].value;
        console.log(departmentValue);

        const findDepartment = departments.find(
          (dep) => dep.name === departmentValue
        );

        const obj = {
          firstName: document.getElementById("firstName").value,
          lastName: document.getElementById("lastName").value,
          startWorkYear: new Date().getFullYear(),
          departmentId: findDepartment._id,
        };

        const response = await fetch(urlEmployees, {
          method: "post",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(obj),
        });
      }
    </script>
  </body>
</html>
